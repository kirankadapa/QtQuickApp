name: CI

on: push

jobs:
  build_and_test:
    name: "Build and test"
    strategy:
      matrix:
        os: [ubuntu-latest, windows-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Install dependencies (linux)
        run: sudo apt install ninja-build
        if: matrix.os == 'ubuntu-latest'
      
      - name: Install Chocolatey and Ninja (windows)
        run: |
          @"%SystemRoot%\System32\WindowsPowerShell\v1.0\powershell.exe" -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command "iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))"
          SET "PATH=%PATH%;%ALLUSERSPROFILE%\chocolatey\bin"
          choco install ninja -y
        shell: cmd
        if: matrix.os == 'windows-latest'
      
      - name: Download and Extract Qt
        run: |
          $pythonArchiveUrl = "https://github.com/actions/python-versions/releases/download/3.11.9-9667582339/python-3.11.9-win32-x64.zip"
          $downloadPath = "$env:TEMP\python-archive.zip"
          Invoke-WebRequest -Uri $pythonArchiveUrl -OutFile $downloadPath
          Expand-Archive -Path $downloadPath -DestinationPath "$env:TEMP\python-3.11.9" -Force
        shell: cmd
        if: matrix.os == 'windows-latest'
        
      - uses: ilammy/msvc-dev-cmd@v1
      
      - uses: actions/checkout@v3

      - name: Build
        run: cmake -S . -B build -G "Ninja Multi-Config" && cmake --build build --config Debug
        shell: cmd
        if: matrix.os == 'windows-latest'
